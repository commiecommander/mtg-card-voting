<script type="module">
  // [Previous Firebase imports and config remain exactly the same...]

  async function fetchCards() {
    const user = auth.currentUser;
    if (!user) return;

    const scryfallUrl = `https://api.scryfall.com/cards/search?q=game:paper+legal:commander&order=edhrec&page=${currentPage}`;
    const proxyUrl = `https://scryfall-proxy.commie-commander-mtg.workers.dev/?url=${encodeURIComponent(scryfallUrl)}`;
    
    try {
      const response = await fetch(proxyUrl);
      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
      
      const data = await response.json();
      console.log('Proxy data:', data);
      
      if (data.data?.length > 0) {
        const sortedCards = data.data.sort((a, b) => (a.edhrec_rank || Infinity) - (b.edhrec_rank || Infinity));
        await displayCards(sortedCards);
        document.getElementById('loading-message').style.display = 'none';
        checkRemainingCards();
      } else {
        document.getElementById('loading-message').textContent = 'No more cards available.';
      }
    } catch (error) {
      console.error('Proxy fetch failed:', error);
      document.getElementById('loading-message').textContent = `Error: ${error.message}`;
    }
  }

  // [All other functions remain exactly the same...]
</script>
