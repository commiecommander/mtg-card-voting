<script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

    // Your Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAGuMe2uHwiIRAB6XFdiKdzrAzPGE_42yY",
        authDomain: "commander-collective-3fdae.firebaseapp.com",
        projectId: "commander-collective-3fdae",
        storageBucket: "commander-collective-3fdae.firebasestorage.app",
        messagingSenderId: "449116378578",
        appId: "1:449116378578:web:762571cc80956cccbda40b",
        measurementId: "G-D61FGMS81X"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Handle login
    const loginForm = document.getElementById('login-form');
    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        try {
            // Look up the user's email in Firestore using their username
            const usernameQuery = query(collection(db, "users"), where("username", "==", username));
            const usernameSnapshot = await getDocs(usernameQuery);

            if (usernameSnapshot.empty) {
                alert('Username not found. Please check your username or register.');
                return;
            }

            // Get the user's email from Firestore
            const userDoc = usernameSnapshot.docs[0];
            const email = userDoc.data().email;

            // Log in with Firebase Authentication using the retrieved email
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            alert('Login successful!');
            window.location.href = 'index.html'; // Redirect to index.html
        } catch (error) {
            alert('Error: ' + error.message);
        }
    });
</script>
