<script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

    // Your Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAGuMe2uHwiIRAB6XFdiKdzrAzPGE_42yY",
        authDomain: "commander-collective-3fdae.firebaseapp.com",
        projectId: "commander-collective-3fdae",
        storageBucket: "commander-collective-3fdae.firebasestorage.app",
        messagingSenderId: "449116378578",
        appId: "1:449116378578:web:762571cc80956cccbda40b",
        measurementId: "G-D61FGMS81X"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Handle registration
    const registerForm = document.getElementById('register-form');
    registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const username = document.getElementById('username').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        try {
            // Check if the username already exists
            const usernameQuery = query(collection(db, "users"), where("username", "==", username));
            const usernameSnapshot = await getDocs(usernameQuery);

            if (!usernameSnapshot.empty) {
                alert('Username already exists. Please choose a different username.');
                return;
            }

            // Create the user with Firebase Authentication
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;

            // Save the username to Firestore
            await setDoc(doc(db, "users", user.uid), {
                username: username,
                email: email,
                createdAt: new Date()
            });

            alert('Registration successful!');
            window.location.href = 'index.html'; // Redirect to index.html
        } catch (error) {
            alert('Error: ' + error.message);
        }
    });
</script>
